!function($){$.Mosaic=function(e,t){var r,o,h=this;h.el=e,h.$el=$(e),h.$el.data("Mosaic",h);var i=!1;h.init=function(){h.options=r=$.extend({},$.Mosaic.defaults,h.$el.data(),t),$(h.el).addClass("jQueryMosaic"),r.outerMargin&&$(h.el).css("padding",r.outerMargin),r.innerGap&&$(h.el).css("margin-bottom",-1*r.innerGap),h.getItems().each(function(e,t){$(t).attr("width")&&$(t).width($(t).attr("width")),$(t).attr("height")&&$(t).height($(t).attr("height"))}),h.fit(),r.refitOnResize&&$(window).on("resize",null,null,function(){r.refitOnResizeDelay?(i&&clearTimeout(i),i=setTimeout(function(){h.fit()},r.refitOnResizeDelay)):h.fit()})},h.getItems=function(){return $("> div:not([data-no-mosaic=true]), > a:not([data-no-mosaic=true]), > img:not([data-no-mosaic=true])",h.el)},h.getItemAtIndex=function(e){return!!h.getItems()[e]&&$(h.getItems()[e])},h.getItemsSubset=function(e,t){var i=h.getItems();return t||(t=i.length-e),!(e>i.length)&&(e+t>i.length&&(t=i.length-e),i.slice(e,e+t))},h.isLastItemsSubset=function(e,t){var i=h.getItems();return e>i.length||e+t>i.length},h.getItemWidth=function(e){return $(e).outerWidth()?$(e).outerWidth():$(e).attr("width")?$(e).attr("width"):void 0},h.getItemHeight=function(e){return $(e).outerHeight()?$(e).outerHeight():$(e).attr("height")?$(e).attr("height"):void 0},h.getItemAspectRatio=function(e){if($(e).data("aspect-ratio"))return $(e).data("aspect-ratio");if(h.getItemWidth(e)&&h.getItemHeight(e)){var t=h.getItemWidth(e)/h.getItemHeight(e);return $(e).data("aspect-ratio",t),t}return r.defaultAspectRatio},h.getItemWidthForGivenHeight=function(e,t){return t*h.getItemAspectRatio(e)},h.getItemHeightForGivenWidth=function(e,t){return t/h.getItemAspectRatio(e)},h.setItemSizeByGivenHeight=function(e,t,i){var a=Math.floor(h.getItemWidthForGivenHeight(e,t));if($(e).width(a+"px"),i?$(e).height("auto"):$(e).height(Math.floor(t)),r.highResImagesWidthThreshold)if(a>r.highResImagesWidthThreshold){var s=$(e).data("high-res-background-image-url");s&&!$(e).data("low-res-background-image-url")&&($(e).data("low-res-background-image-url",$(e).css("background-image")),$(e).css("background-image",'url("'+s+'")'),$(e).addClass("highRes")),$("img",e).add(e).each(function(e,t){var i=$(t).data("high-res-image-src");i&&!$(t).data("low-res-image-src")&&($(t).data("low-res-image-src",$(t).attr("src")),$(t).attr("src",i),$(t).addClass("highRes"))})}else{var n=$(e).data("low-res-background-image-url");n&&($(e).css("background-image",n),$(e).data("low-res-background-image-url",!1),$(e).removeClass("highRes")),$("img",e).add(e).each(function(e,t){var i=$(t).data("low-res-image-src");i&&($(t).attr("src",i),$(t).data("low-res-image-src",!1),$(t).removeClass("highRes"))})}return a},h.calculateHeightToFit=function(e){var t=0;return e.each(function(){t+=parseFloat(h.getItemAspectRatio(this))}),(o-r.innerGap*(e.length-1))/t},h.retrieveBaseWidth=function(){var e=parseFloat($(h.el).width());o=$.isNumeric(e)?e:0},h.isBelowResponsiveWidthThreshold=function(){return r.responsiveWidthThreshold&&o<r.responsiveWidthThreshold},h.fit=function(){if(h.retrieveBaseWidth(),h.isBelowResponsiveWidthThreshold()){var e=h.getItems();return r.maxItemsToShowWhenResponsiveThresholdSurpassed&&($(e).slice(r.maxItemsToShowWhenResponsiveThresholdSurpassed).remove(),e=$(e).slice(0,r.maxItemsToShowWhenResponsiveThresholdSurpassed)),void e.each(function(){var e=h.getItemHeightForGivenWidth(this,o);$(this).width(o),$(this).data("only-force-height-when-necessary")?$(this).height("auto"):$(this).height(e),r.innerGap&&$(this).css("margin-bottom",r.innerGap)})}for(var t=1,i=0,a=!1,s=1;;){if(e=h.getItemsSubset(i,t),h.isLastItemsSubset(i,t)){e.length&&h.fitItems(e);break}if(h.calculateHeightToFit(e)>r.maxRowHeight)t++;else{if(h.fitItems(e),i+=t,t=1,a=!0,!h.isBelowResponsiveWidthThreshold()&&r.maxRows&&s==r.maxRows)return void h.getItemsSubset(i).each(function(){$(this).hide()});s++}}a||(r.showTailWhenNotEnoughItemsForEvenOneRow&&(r.maxRowHeightPolicy="tail"),h.fitItems(h.getItems()))},h.fitItems=function(t){var i=!1,a=h.calculateHeightToFit(t);if(a>r.maxRowHeight)switch(r.maxRowHeightPolicy){case"skip":return void t.each(function(){$(this).hide()});case"crop":a=r.maxRowHeight;break;case"oversize":i=!0;break;case"tail":a=r.maxRowHeight;var e=!0}t.each(function(){$(this).show()});var s=0;if(t.each(function(e){s+=h.setItemSizeByGivenHeight(this,a,i&&$(this).data("only-force-height-when-necessary")),r.innerGap&&($(this).css("margin-right",e<t.length-1?r.innerGap:0),$(this).css("margin-bottom",r.innerGap))}),!e&&s!=o-(t.length-1)*r.innerGap){difference=o-(t.length-1)*r.innerGap-s;var n=t.last().width();t.last().width(n+difference)}},h.init()},$.Mosaic.defaults={maxRowHeight:400,refitOnResize:!0,refitOnResizeDelay:!1,defaultAspectRatio:1,maxRowHeightPolicy:"skip",maxRows:!1,highResImagesWidthThreshold:350,outerMargin:0,innerGap:0,responsiveWidthThreshold:!1,maxItemsToShowWhenResponsiveThresholdSurpassed:!1,showTailWhenNotEnoughItemsForEvenOneRow:!1},$.fn.Mosaic=function(options,params){return this.each(function(){var me=$(this).data("Mosaic");(typeof options).match("object|undefined")?new $.Mosaic(this,options):eval("me."+options)(params)})}}(jQuery);