!function($){$.Mosaic=function(t,e){var h,c=this;c.el=t,c.$el=$(t);var n,i=c.$el.data();c.$el.data("Mosaic",c);var a=!1;c.init=function(){c.options=h=$.extend({},$.Mosaic.defaults,i,e),$(c.el).addClass("jQueryMosaic"),h.outerMargin&&$(c.el).css("padding",h.outerMargin),h.innerGap&&$(c.el).css("margin-bottom",-1*h.innerGap),c.getItems().each(function(t,e){$(e).attr("width")&&$(e).css("width",$(e).attr("width")),$(e).attr("height")&&$(e).css("height",$(e).attr("height"))}),c.fit(),h.refitOnResize&&$(window).on("resize",null,null,function(){h.refitOnResizeDelay?(a&&clearTimeout(a),a=setTimeout(function(){c.fit()},h.refitOnResizeDelay)):c.fit()})},c.getItems=function(){return $("> div:not([data-no-mosaic=true]), > a:not([data-no-mosaic=true]), > img:not([data-no-mosaic=true])",c.el)},c.getItemAtIndex=function(t){return!!c.getItems()[t]&&$(c.getItems()[t])},c.getItemsSubset=function(t,e){var i=c.getItems();return!(t>i.length)&&(t+e>i.length&&(e=i.length-t),i.slice(t,t+e))},c.isLastItemsSubset=function(t,e){var i=c.getItems();return t>i.length||t+e>i.length},c.getItemWidth=function(t){return $(t).outerWidth()?$(t).outerWidth():$(t).attr("width")?$(t).attr("width"):void 0},c.getItemHeight=function(t){return $(t).outerHeight()?$(t).outerHeight():$(t).attr("height")?$(t).attr("height"):void 0},c.getItemAspectRatio=function(t){if($(t).data("aspect-ratio"))return $(t).data("aspect-ratio");if(c.getItemWidth(t)&&c.getItemHeight(t)){var e=c.getItemWidth(t)/c.getItemHeight(t);return $(t).data("aspect-ratio",e),e}return h.defaultAspectRatio},c.getItemWidthForGivenHeight=function(t,e){return e*c.getItemAspectRatio(t)},c.getItemHeightForGivenWidth=function(t,e){return e/c.getItemAspectRatio(t)},c.setItemSizeByGivenHeight=function(t,e,i){var a=Math.floor(c.getItemWidthForGivenHeight(t,e));if($(t).css("width",a+"px"),i?$(t).css("height","auto"):$(t).css("height",Math.floor(e)+"px"),h.highResImagesWidthThreshold)if(a>h.highResImagesWidthThreshold){var s=$(t).data("high-res-background-image-url");s&&!$(t).data("low-res-background-image-url")&&($(t).data("low-res-background-image-url",$(t).css("background-image")),$(t).css("background-image",'url("'+s+'")'),$(t).addClass("highRes"));var r=$(t).data("high-res-image-src");r&&!$(t).data("low-res-image-src")&&($(t).data("low-res-image-src",$(t).attr("src")),$(t).attr("src",r),$(t).addClass("highRes"))}else{var n=$(t).data("low-res-background-image-url");n&&($(t).css("background-image",n),$(t).data("low-res-background-image-url",!1),$(t).removeClass("highRes"));var o=$(t).data("low-res-image-src");o&&($(t).attr("src",o),$(t).data("low-res-image-src",!1),$(t).removeClass("highRes"))}return a},c.calculateHeightToFit=function(t){var e=0;return t.each(function(){e+=parseFloat(c.getItemAspectRatio(this))}),(n-h.innerGap*(t.length-1))/e},c.retrieveBaseWidth=function(){n=Math.floor($(c.el).width())},c.fit=function(){if(c.retrieveBaseWidth(),h.responsiveWidthThreshold&&n<h.responsiveWidthThreshold)c.getItems().each(function(){var t=c.getItemHeightForGivenWidth(this,n);$(this).css("width",n),$(this).data("only-force-height-when-necessary")?$(this).css("height","auto"):$(this).css("height",t),h.innerGap&&$(this).css("margin-bottom",h.innerGap)});else{for(var t,e=1,i=0,a=!1;;){if(t=c.getItemsSubset(i,e),c.isLastItemsSubset(i,e)){t.length&&c.fitItems(t);break}c.calculateHeightToFit(t)>h.maxRowHeight?e++:(c.fitItems(t),i+=e,e=1,a=!0)}a||c.fitItems(c.getItems())}},c.fitItems=function(e){var i=!1,a=c.calculateHeightToFit(e);if(a>h.maxRowHeight)switch(h.maxRowHeightPolicy){case"skip":return void e.each(function(){$(this).hide()});case"crop":a=h.maxRowHeight;break;case"oversize":i=!0;break;case"tail":a=h.maxRowHeight;var t=!0}e.each(function(){$(this).show()});var s=0;if(e.each(function(t){s+=c.setItemSizeByGivenHeight(this,a,i&&$(this).data("only-force-height-when-necessary")),h.innerGap&&($(this).css("margin-right",t<e.length-1?h.innerGap:0),$(this).css("margin-bottom",h.innerGap))}),!t&&s!=n-(e.length-1)*h.innerGap){difference=n-(e.length-1)*h.innerGap-s;var r=e.last().width();e.last().width(r+difference)}},c.init()},$.Mosaic.defaults={maxRowHeight:400,refitOnResize:!0,refitOnResizeDelay:!1,defaultAspectRatio:1,maxRowHeightPolicy:"skip",highResImagesWidthThreshold:350,outerMargin:0,innerGap:0,responsiveWidthThreshold:!1},$.fn.Mosaic=function(options,params){return this.each(function(){var me=$(this).data("Mosaic");(typeof options).match("object|undefined")?new $.Mosaic(this,options):eval("me."+options)(params)})}}(jQuery);